<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>reDoar - Consultas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            background-color: #000;
            color: white;
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }

        .navbar {
            background-color: #692CAB;
            padding: 8px 40px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            border-radius: 0px 0px 0px 50px;
            width: fit-content;
            margin-left: auto;
            margin-right: 0;
            margin-bottom: 15px;
        }

        .navbar-button {
            background: none;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 14px;
            font-family: 'Poppins', sans-serif;
            padding: 5px 8px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .navbar-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .main-container {
            display: flex;
            height: calc(100vh - 63px);
        }

        .left-panel {
            width: 300px;
            background-color: #692CAB;
            padding: 30px 20px;
            border-top-right-radius: 40px;
            border-bottom-right-radius: 40px;
            position: relative;
        }

        .panel-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .panel-logo img {
            width: 40px;
        }

        .panel-logo h2 {
            font-size: 16px;
            font-weight: bold;
            line-height: 1.2;
            margin: 0;
        }

        .panel-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 30px;
        }

        .panel-inputs .input-wrapper {
            display: flex;
            align-items: center;
            background-color: white;
            border-radius: 10px;
            padding: 6px 10px;
        }

        .panel-inputs .input-wrapper i {
            color: #692CAB;
            margin-right: 10px;
        }

        .panel-inputs input {
            border: none;
            border-radius: 10px;
            font-size: 14px;
            padding: 6px;
            outline: none;
            width: 100%;
        }

        .panel-button {
            background-color: #A370F0;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px;
            width: 100%;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: 0.3s;
        }

        .panel-button:hover {
            background-color: #8f5dd9;
        }

        .panel-dots {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
        }

        .panel-dots span {
            display: inline-block;
            height: 8px;
            width: 8px;
            background-color: white;
            border-radius: 50%;
            margin: 0 3px;
        }

        .right-panel {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 40px;
            overflow-y: auto;
        }

        .result-container {
            flex: 1;
            color: white;
        }

        .no-results {
            text-align: center;
            font-style: italic;
            margin-top: 50px;
            color: #ccc;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #444;
        }

        th {
            background-color: #692CAB;
            color: white;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background-color: rgba(105, 44, 171, 0.1);
        }

        .panel-generate-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: white;
            color: #000;
            font-weight: bold;
            font-size: 14px;
            border-radius: 10px;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
        }

        .panel-generate-btn:hover {
            background-color: #ddd;
        }

        .back-arrow {
            position: fixed;
            bottom: 25px;
            left: 25px;
            background: linear-gradient(145deg, #7c3aed, #9D71E3);
            color: white;
            padding: 14px 16px;
            border-radius: 50px;
            font-size: 18px;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 12px rgba(0,0,0,0.25);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .back-arrow:hover {
            background: linear-gradient(145deg, #692CAB, #7c3aed);
            transform: translateY(-2px) scale(1.05);
        }

        .periodo-consulta {
            margin-bottom: 20px;
            font-size: 18px;
            color: #A370F0;
        }

        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }

        .popup-content {
            background-color: #1a1a1a;
            border-radius: 15px;
            position: relative;
            margin: 15% auto;
            padding: 20px;
            width: 80%;
            max-width: 500px;
            color: white;
            border: 2px solid #692CAB;
        }

        .fechar-popup {
            color: #9D71E3;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .fechar-popup:hover {
            color: #692CAB;
        }

        .contatos-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .contato-item {
            padding: 15px;
            border-radius: 10px;
            background-color: #292929;
            transition: all 0.3s ease;
        }

        .contato-item:hover {
            background-color: #692CAB;
            transform: scale(1.05);
        }

        .contato-item i {
            font-size: 24px;
            color: #9D71E3;
            margin-bottom: 10px;
        }

        .contato-item:hover i {
            color: white;
        }

        .contato-item p {
            margin: 0;
            font-size: 14px;
        }

        .contato-item a {
            color: #9D71E3;
            text-decoration: none;
        }

        .contato-item:hover a {
            color: white;
        }

        .popup-content h2 {
            color: #9D71E3;
            text-align: center;
            margin-bottom: 20px;
        }

        .panel-inputs input::placeholder {
            color: #999;
            opacity: 0.5;
        }

        .panel-inputs select {
            background-color: white;
            border-radius: 10px;
            color: #333;
        }

        .panel-inputs select:focus {
            outline: none;
        }

        .filtro-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }



        .filtro-select option {
            background-color: #1a1a1a;
            color: white;
        }


        .filtro-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap; /* Permite que os botões quebrem linha em telas menores */
        }


        .filtro-btn {
            background-color: #A370F0;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 8px 16px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .filtro-btn:hover {
            background-color: #8f5dd9;
            transform: translateY(-2px);
        }

        .filtro-btn.active {
            background-color: #692CAB;
            box-shadow: 0 4px 8px rgba(105, 44, 171, 0.3);
        }



    </style>
</head>
<body>

<nav class="navbar">
    <button onclick="window.location.href='/Projetos'" class="navbar-button">Projetos</button>
    <button onclick="abrirPopupContatos()" class="navbar-button">Contatos</button>
    <button onclick="window.location.href='/telainicial'" class="navbar-button"> Sair </button>
</nav>

<div class="main-container">
    <input type="hidden" id="tipoConsultaAtual" th:value="${tipoConsulta}">
    <div class="left-panel">
        <div class="panel-logo">
            <img th:src="@{/logo-02.png}" alt="Logo reDoar" style="width: 150px;">
            <h2>Associação<br>Casa de Davi</h2>
        </div>

        <form id="consultaForm" method="post">
            <div class="panel-inputs">
                <div class="input-wrapper">
                    <i class="fas fa-calendar-alt"></i>
                    <input type="text" name="dataInicio" placeholder="__/__/____" required
                           pattern="\d{2}/\d{2}/\d{4}"
                           th:value="${dataInicio}">
                </div>
                <div class="input-wrapper">
                    <i class="fas fa-calendar-alt"></i>
                    <input type="text" name="dataFim" placeholder="__/__/____" required
                           pattern="\d{2}/\d{2}/\d{4}"
                           th:value="${dataFim}">
                </div>


            </div>

            <button type="submit" formaction="/consultarDoadores" class="panel-button">Doadores</button>
            <button type="submit" formaction="/consultarFuncionarios" class="panel-button">Funcionários</button>
            <button type="submit" formaction="/consultarDoacoes" class="panel-button">Doações</button>
            <button type="submit" formaction="/consultarParceiros" class="panel-button">Parceiros</button>
        </form>

        <div class="panel-dots">
            <span></span><span></span><span></span><span></span>
        </div>
    </div>

    <div class="right-panel">
        <div class="result-container">
            <!-- Resultados de Funcionários -->
            <div th:if="${tipoConsulta == 'funcionarios'}">
                <h3 class="periodo-consulta">Funcionários cadastrados:
                    <span th:text="${dataInicio}"></span>  <span th:text="${dataFim}"></span>
                </h3>

                <div th:if="${funcionarios == null or funcionarios.isEmpty()}" class="no-results">
                    <i class="fas fa-info-circle" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <p>Nenhum funcionário encontrado no período especificado.</p>
                </div>

                <table th:if="${funcionarios != null and !funcionarios.isEmpty()}" border="1">
                    <thead>
                    <tr>
                        <th>Nome</th>
                        <th>CPF</th>
                        <th>Email</th>
                        <th>Cargo</th>
                        <th>Data Cadastro</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="funcionario : ${funcionarios}">
                        <td th:text="${funcionario.nome}"></td>
                        <td th:text="${funcionario.cpf}"></td>
                        <td th:text="${funcionario.email}"></td>
                        <td th:text="${funcionario.cargo}"></td>
                        <td th:text="${funcionario.dataCadastro != null} ? ${#temporals.format(funcionario.dataCadastro, 'dd/MM/yyyy HH:mm')} : 'Não informado'"></td>
                    </tr>
                    </tbody>
                </table>
            </div>




            <!-- Resultados de Doadores -->
            <div th:if="${tipoConsulta == 'doadores'}">
                <h3 class="periodo-consulta">Doadores cadastrados:
                    <span th:text="${dataInicio}"></span>  <span th:text="${dataFim}"></span>
                </h3>

                <div class="filtro-container" style="margin-bottom: 20px;">
                    <button type="button" class="filtro-btn active" data-tipo="">Todos</button>
                    <button type="button" class="filtro-btn" data-tipo="PF">Pessoa Física</button>
                    <button type="button" class="filtro-btn" data-tipo="PJ">Pessoa Jurídica</button>
                </div>




                <div th:if="${doadores == null or doadores.isEmpty()}" class="no-results">
                    <i class="fas fa-info-circle" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <p>Nenhum doador encontrado no período especificado.</p>
                </div>

                <table th:if="${doadores != null and !doadores.isEmpty()}" border="1">
                    <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Nome/Razão Social</th>
                        <th>Documento</th>
                        <th>Email</th>
                        <th>Data Cadastro</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="doador : ${doadores}">
                        <td th:text="${doador.tipo == 'PF' ? 'Pessoa Física' : 'Pessoa Jurídica'}"></td>
                        <td th:text="${doador.tipo == 'PF' ? doador.nomeCompleto : doador.razaoSocial}"></td>
                        <td th:text="${doador.documento}"></td>
                        <td th:text="${doador.email}"></td>
                        <td th:text="${doador.dataCadastro != null} ? ${#temporals.format(doador.dataCadastro, 'dd/MM/yyyy HH:mm')} : 'Não informado'"></td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Resultados de Doações (única seção) -->
            <div th:if="${tipoConsulta == 'doacoes'}">
                <h3 class="periodo-consulta">Doações cadastradas:
                    <span th:text="${dataInicio}"></span> <span th:text="${dataFim}"></span>
                </h3>

                <div class="filtro-container" style="margin-bottom: 20px;">
                    <button type="button" class="filtro-btn active" data-pagamento="">Todos</button>
                    <button type="button" class="filtro-btn" data-pagamento="dinheiro">Dinheiro</button>
                    <button type="button" class="filtro-btn" data-pagamento="pix">PIX</button>
                    <button type="button" class="filtro-btn" data-pagamento="cartao_credito">Cartão de Crédito</button>
                    <button type="button" class="filtro-btn" data-pagamento="cartao_debito">Cartão de Débito</button>
                    <button type="button" class="filtro-btn" data-pagamento="transferencia">Transferência</button>
                    <button type="button" class="filtro-btn" data-pagamento="cheque">Cheque</button>
                </div>


                <div th:if="${doacoes == null or doacoes.isEmpty()}" class="no-results">
                    <i class="fas fa-info-circle" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <p>Nenhuma doação encontrada no período especificado.</p>
                </div>

                <table th:if="${doacoes != null and !doacoes.isEmpty()}" border="1">
                    <thead>
                    <tr>
                        <th>Valor</th>
                        <th>Data</th>
                        <th>Doador</th>
                        <th>Método de Pagamento</th>
                        <th>Observações</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="doacao : ${doacoes}">
                        <td th:text="${'R$ ' + #numbers.formatDecimal(doacao.valor, 1, 2, 'POINT')}"></td>
                        <td th:text="${#temporals.format(doacao.data, 'dd/MM/yyyy HH:mm')}"></td>
                        <td th:text="${doacao.doador.tipo == 'PF' ? doacao.doador.nomeCompleto : doacao.doador.razaoSocial}"></td>
                        <td th:text="${doacao.metodoPagamento}"></td>
                        <td th:text="${doacao.observacao != null ? doacao.observacao : '-'}"></td>
                    </tr>
                    </tbody>
                </table>
                <div th:if="${doacoes != null and !doacoes.isEmpty()}"
                     style="text-align: right; margin-top: 20px; padding: 15px; background-color: #692CAB; border-radius: 10px;">
                    <strong style="font-size: 18px;">
                        Total do Período:
                        <span th:text="${'R$ ' + #numbers.formatDecimal(totalDoacoes, 1, 2, 'POINT')}">
        </span>
                    </strong>
                </div>
            </div>

            <!-- Resultados de Parceiros -->
            <div th:if="${tipoConsulta == 'parceiros'}">
                <h3 class="periodo-consulta">Parceiros cadastrados:
                    <span th:text="${dataInicio}"></span> <span th:text="${dataFim}"></span>
                </h3>

                <div th:if="${parceiros == null or parceiros.isEmpty()}" class="no-results">
                    <i class="fas fa-info-circle" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <p>Nenhum parceiro encontrado no período especificado.</p>
                </div>

                <table th:if="${parceiros != null and !parceiros.isEmpty()}" border="1">
                    <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Razão Social</th>
                        <th>CNPJ</th>
                        <th>Email</th>
                        <th>Telefone</th>
                        <th>Responsável</th>
                        <th>Data Cadastro</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="parceiro : ${parceiros}">
                        <td>Pessoa Jurídica</td>
                        <td th:text="${parceiro.razaoSocial}"></td>
                        <td th:text="${parceiro.documento}"></td>
                        <td th:text="${parceiro.email}"></td>
                        <td th:text="${parceiro.telefone}"></td>
                        <td th:text="${parceiro.responsavel}"></td>
                        <td th:text="${parceiro.dataCadastro != null} ? ${#temporals.format(parceiro.dataCadastro, 'dd/MM/yyyy HH:mm')} : 'Não informado'"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <button type="button" class="panel-generate-btn"
                th:data-tipo="${tipoConsulta}"
                th:if="${tipoConsulta != null and
                ((tipoConsulta == 'funcionarios' and funcionarios != null and !funcionarios.isEmpty()) or
                 (tipoConsulta == 'doadores' and doadores != null and !doadores.isEmpty()) or
                 (tipoConsulta == 'doacoes' and doacoes != null and !doacoes.isEmpty()) or
                 (tipoConsulta == 'parceiros' and parceiros != null and !parceiros.isEmpty()))}">
            <i class="fas fa-file-export"></i> Gerar Relatório
        </button>


    </div>
</div>

<a href="/telaAutenticado" class="back-arrow" title="Voltar">
    <i class="fas fa-arrow-left"></i>
</a>

<div id="popupContatos" class="popup">
    <div class="popup-content">
        <span class="fechar-popup">&times;</span>
        <h2>Nossos Contatos</h2>
        <div class="contatos-grid">
            <div class="contato-item">
                <i class="fas fa-phone"></i>
                <p>(34) 99999-9999</p>
            </div>
            <div class="contato-item">
                <i class="fas fa-envelope"></i>
                <p>contato@casadedavi.org.br</p>
            </div>
            <div class="contato-item">
                <i class="fas fa-map-marker-alt"></i>
                <p>Rua Example, 123 - Bairro - Araguari/MG</p>
            </div>
            <div class="contato-item">
                <a href="https://facebook.com/" target="_blank">
                    <i class="fab fa-facebook"></i>
                </a>
            </div>
            <div class="contato-item">
                <a href="https://instagram.com/" target="_blank">
                    <i class="fab fa-instagram"></i>
                </a>
            </div>
            <div class="contato-item">
                <a href="https://api.whatsapp.com/send?phone=5534999999999" target="_blank">
                    <i class="fab fa-whatsapp"></i>
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    function abrirPopupContatos() {
        document.getElementById('popupContatos').style.display = 'block';
    }

    document.querySelector('.fechar-popup').addEventListener('click', function() {
        document.getElementById('popupContatos').style.display = 'none';
    });

    window.addEventListener('click', function(event) {
        let popup = document.getElementById('popupContatos');
        if (event.target == popup) {
            popup.style.display = 'none';
        }
    });



    function formatDate(input) {
        let value = input.value.replace(/\D/g, '');

        if (value.length >= 2) {
            value = value.substring(0, 2) + '/' + value.substring(2);
        }
        if (value.length >= 5) {
            value = value.substring(0, 5) + '/' + value.substring(5);
        }
        if (value.length > 10) {
            value = value.substring(0, 10);
        }

        input.value = value;
    }

   document.addEventListener('DOMContentLoaded', function() {
        let dateInputs = document.querySelectorAll('input[name="dataInicio"], input[name="dataFim"]');
        dateInputs.forEach(function(input) {
            input.addEventListener('input', function() {
                formatDate(this);
            });
        });
    });


    document.addEventListener('DOMContentLoaded', function() {
        let tipoDoadorAtivo = '';
        let metodoPagamentoAtivo = '';

        const filtroTipoButtons = document.querySelectorAll('.filtro-container .filtro-btn[data-tipo]');
        if (filtroTipoButtons.length > 0) {
            filtroTipoButtons.forEach(button => {
                button.addEventListener('click', function () {
                    filtroTipoButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');

                    tipoDoadorAtivo = this.getAttribute('data-tipo');
                    aplicarFiltros();
                });
            });
        }

        const filtroPagamentoButtons = document.querySelectorAll('.filtro-container .filtro-btn[data-pagamento]');
        if (filtroPagamentoButtons.length > 0) {
            filtroPagamentoButtons.forEach(button => {
                button.addEventListener('click', function () {
                    filtroPagamentoButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');

                    metodoPagamentoAtivo = this.getAttribute('data-pagamento');

                    aplicarFiltros();
                });
            });
        }

        function aplicarFiltros() {
            const rows = document.querySelectorAll('table tbody tr');
            let total = 0;

            rows.forEach(row => {
                const tipoCell = row.cells[0].textContent;
                const pagamentoCell = row.cells[3].textContent.toLowerCase();
                let mostrarLinha = true;


                if (tipoDoadorAtivo !== '') {
                    if (tipoDoadorAtivo === 'PF' && tipoCell !== 'Pessoa Física') {
                        mostrarLinha = false;
                    } else if (tipoDoadorAtivo === 'PJ' && tipoCell !== 'Pessoa Jurídica') {
                        mostrarLinha = false;
                    }
                }


                if (metodoPagamentoAtivo !== '' && mostrarLinha) {
                    if (pagamentoCell !== metodoPagamentoAtivo) {
                        mostrarLinha = false;
                    }
                }


                row.style.display = mostrarLinha ? '' : 'none';


                if (mostrarLinha) {
                    const valorStr = row.cells[0].textContent.replace('R$ ', '').replace(',', '.');
                    total += parseFloat(valorStr);
                }
            });

            const totalElement = document.querySelector('.result-container strong span');
            if (totalElement) {
                totalElement.textContent = 'R$ ' + total.toFixed(2).replace('.', ',');
            }
        }
    });


    document.querySelector('.panel-generate-btn').addEventListener('click', function() {
        const tipoConsulta = document.getElementById('tipoConsultaAtual').value;
        const dataInicio = document.querySelector('input[name="dataInicio"]').value;
        const dataFim = document.querySelector('input[name="dataFim"]').value;

        if (!tipoConsulta) {
            alert('Tipo de relatório não identificado');
            return;
        }

        if (!dataInicio || !dataFim) {
            alert('Por favor, preencha as datas de início e fim');
            return;
        }

        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/relatorios/gerar/${tipoConsulta}`;

        const addHiddenInput = (name, value) => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = name;
            input.value = value;
            form.appendChild(input);
        };

        addHiddenInput('dataInicio', dataInicio);
        addHiddenInput('dataFim', dataFim);

        // Adiciona o filtro ativo de tipo de doador
        if (tipoConsulta === 'doadores') {
            const tipoDoadorAtivo = document.querySelector('.filtro-container .filtro-btn[data-tipo].active').getAttribute('data-tipo');
            addHiddenInput('filtroTipo', tipoDoadorAtivo);
        }

        // Adiciona o filtro ativo de método de pagamento
        if (tipoConsulta === 'doacoes') {
            const metodoPagamentoAtivo = document.querySelector('.filtro-container .filtro-btn[data-pagamento].active').getAttribute('data-pagamento');
            addHiddenInput('filtroPagamento', metodoPagamentoAtivo);
        }

        // Adiciona o filtro específico para parceiros
        if (tipoConsulta === 'parceiros') {
            addHiddenInput('filtro', 'PJ');
        }

        document.body.appendChild(form);
        form.submit();
    });
    
</script>


</body>
</html>